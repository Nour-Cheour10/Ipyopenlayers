var Qt=class{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}};var $=Qt;var Le={PROPERTYCHANGE:"propertychange"};var $t=class{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}},Ae=$t;function Ui(i,t){return i>t?1:i<t?-1:0}function Oe(i,t,e){if(i[0]<=t)return 0;let r=i.length;if(t<=i[r-1])return r-1;if(typeof e=="function"){for(let n=1;n<r;++n){let s=i[n];if(s===t)return n;if(s<t)return e(t,i[n-1],s)>0?n-1:n}return r-1}if(e>0){for(let n=1;n<r;++n)if(i[n]<t)return n-1;return r-1}if(e<0){for(let n=1;n<r;++n)if(i[n]<=t)return n;return r-1}for(let n=1;n<r;++n){if(i[n]==t)return n;if(i[n]<t)return i[n-1]-t<t-i[n]?n-1:n}return r-1}function Xe(i,t,e){let r=t||Ui;return i.every(function(n,s){if(s===0)return!0;let o=r(i[s-1],n);return!(o>0||e&&o===0)})}function te(){}function St(i){for(let t in i)delete i[t]}function Ge(i){let t;for(t in i)return!1;return!t}var ee=class extends Ae{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;let r=this.listeners_||(this.listeners_={}),n=r[t]||(r[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){let e=typeof t=="string",r=e?t:t.type,n=this.listeners_&&this.listeners_[r];if(!n)return;let s=e?new $(t):t;s.target||(s.target=this.eventTarget_||this);let o=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});r in o||(o[r]=0,l[r]=0),++o[r];let a;for(let c=0,u=n.length;c<u;++c)if("handleEvent"in n[c]?a=n[c].handleEvent(s):a=n[c].call(this,s),a===!1||s.propagationStopped){a=!1;break}if(--o[r]===0){let c=l[r];for(delete l[r];c--;)this.removeEventListener(r,te);delete o[r]}return a}disposeInternal(){this.listeners_&&St(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){if(!this.listeners_)return;let r=this.listeners_[t];if(!r)return;let n=r.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[n]=te,++this.pendingRemovals_[t]):(r.splice(n,1),r.length===0&&delete this.listeners_[t]))}},vt=ee;var M={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function tt(i,t,e,r,n){if(r&&r!==i&&(e=e.bind(r)),n){let o=e;e=function(){i.removeEventListener(t,e),o.apply(this,arguments)}}let s={target:i,type:t,listener:e};return i.addEventListener(t,e),s}function et(i,t,e,r){return tt(i,t,e,r,!0)}function G(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),St(i))}var it=class extends vt{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(M.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){let r=t.length,n=new Array(r);for(let s=0;s<r;++s)n[s]=tt(this,t[s],e);return n}return tt(this,t,e)}onceInternal(t,e){let r;if(Array.isArray(t)){let n=t.length;r=new Array(n);for(let s=0;s<n;++s)r[s]=et(this,t[s],e)}else r=et(this,t,e);return e.ol_key=r,r}unInternal(t,e){let r=e.ol_key;if(r)bi(r);else if(Array.isArray(t))for(let n=0,s=t.length;n<s;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}};it.prototype.on;it.prototype.once;it.prototype.un;function bi(i){if(Array.isArray(i))for(let t=0,e=i.length;t<e;++t)G(i[t]);else G(i)}var Ue=it;function Mt(){throw new Error("Unimplemented abstract method.")}var Di=0;function U(i){return i.ol_uid||(i.ol_uid=String(++Di))}var It=class extends ${constructor(t,e,r){super(t),this.key=e,this.oldValue=r}},ie=class extends Ue{constructor(t){super(),this.on,this.once,this.un,U(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}getPropertiesInternal(){return this.values_}hasProperties(){return!!this.values_}notify(t,e){let r;r=`change:${t}`,this.hasListener(r)&&this.dispatchEvent(new It(r,t,e)),r=Le.PROPERTYCHANGE,this.hasListener(r)&&this.dispatchEvent(new It(r,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,r){let n=this.values_||(this.values_={});if(r)n[t]=e;else{let s=n[t];n[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(let r in t)this.set(r,t[r],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){let r=this.values_[t];delete this.values_[t],Ge(this.values_)&&(this.values_=null),e||this.notify(t,r)}}},be=ie;function S(i,t){if(!i)throw new Error(t)}function pt(i,t,e){return Math.min(Math.max(i,t),e)}function De(i){let t=i.length;for(let r=0;r<t;r++){let n=r,s=Math.abs(i[r][r]);for(let l=r+1;l<t;l++){let a=Math.abs(i[l][r]);a>s&&(s=a,n=l)}if(s===0)return null;let o=i[n];i[n]=i[r],i[r]=o;for(let l=r+1;l<t;l++){let a=-i[l][r]/i[r][r];for(let c=r;c<t+1;c++)r==c?i[l][c]=0:i[l][c]+=a*i[r][c]}}let e=new Array(t);for(let r=t-1;r>=0;r--){e[r]=i[r][t]/i[r][r];for(let n=r-1;n>=0;n--)i[n][t]-=i[n][r]*e[r]}return e}function Lt(i){return i*Math.PI/180}function rt(i,t){let e=i%t;return e*t<0?e+t:e}function Ye(i,t){let e=Math.pow(10,t);return Math.round(i*e)/e}function _t(i,t){return Math.floor(Ye(i,t))}function Et(i,t){return Math.ceil(Ye(i,t))}var q={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};var re=class{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||q[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}},At=re;var xt=6378137,nt=Math.PI*xt,Yi=[-nt,-nt,nt,nt],ji=[-180,-85,180,85],Ot=xt*Math.log(Math.tan(Math.PI/2)),b=class extends At{constructor(t){super({code:t,units:"m",extent:Yi,global:!0,worldExtent:ji,getPointResolution:function(e,r){return e/Math.cosh(r[1]/xt)}})}},ne=[new b("EPSG:3857"),new b("EPSG:102100"),new b("EPSG:102113"),new b("EPSG:900913"),new b("http://www.opengis.net/def/crs/EPSG/0/3857"),new b("http://www.opengis.net/gml/srs/epsg.xml#3857")];function je(i,t,e){let r=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let n=0;n<r;n+=e){t[n]=nt*i[n]/180;let s=xt*Math.log(Math.tan(Math.PI*(+i[n+1]+90)/360));s>Ot?s=Ot:s<-Ot&&(s=-Ot),t[n+1]=s}return t}function We(i,t,e){let r=i.length;e=e>1?e:2,t===void 0&&(e>2?t=i.slice():t=new Array(r));for(let n=0;n<r;n+=e)t[n]=180*i[n]/nt,t[n+1]=360*Math.atan(Math.exp(i[n+1]/xt))/Math.PI-90;return t}var Wi=6378137,ze=[-180,-90,180,90],zi=Math.PI*Wi/180,X=class extends At{constructor(t,e){super({code:t,units:"degrees",extent:ze,axisOrientation:e,global:!0,metersPerUnit:zi,worldExtent:ze})}},se=[new X("CRS:84"),new X("EPSG:4326","neu"),new X("urn:ogc:def:crs:OGC:1.3:CRS84"),new X("urn:ogc:def:crs:OGC:2:84"),new X("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new X("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new X("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];var oe={};function Ne(i){return oe[i]||oe[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Ze(i,t){oe[i]=t}var st={};function Tt(i,t,e){let r=i.getCode(),n=t.getCode();r in st||(st[r]={}),st[r][n]=e}function Ke(i,t){let e;return i in st&&t in st[i]&&(e=st[i][t]),e}var w={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function le(i){let t=D();for(let e=0,r=i.length;e<r;++e)yt(t,i[e]);return t}function Xt(i,t){return Ni(i,t[0],t[1])}function qe(i,t){return i[0]<=t[0]&&t[2]<=i[2]&&i[1]<=t[1]&&t[3]<=i[3]}function Ni(i,t,e){return i[0]<=t&&t<=i[2]&&i[1]<=e&&e<=i[3]}function ke(i,t){let e=i[0],r=i[1],n=i[2],s=i[3],o=t[0],l=t[1],a=w.UNKNOWN;return o<e?a=a|w.LEFT:o>n&&(a=a|w.RIGHT),l<r?a=a|w.BELOW:l>s&&(a=a|w.ABOVE),a===w.UNKNOWN&&(a=w.INTERSECTING),a}function D(){return[1/0,1/0,-1/0,-1/0]}function Ct(i,t,e,r,n){return n?(n[0]=i,n[1]=t,n[2]=e,n[3]=r,n):[i,t,e,r]}function Zi(i){return Ct(1/0,1/0,-1/0,-1/0,i)}function Be(i,t){return t[0]<i[0]&&(i[0]=t[0]),t[2]>i[2]&&(i[2]=t[2]),t[1]<i[1]&&(i[1]=t[1]),t[3]>i[3]&&(i[3]=t[3]),i}function yt(i,t){t[0]<i[0]&&(i[0]=t[0]),t[0]>i[2]&&(i[2]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[1]>i[3]&&(i[3]=t[1])}function He(i,t,e,r,n){for(;e<r;e+=n)Ki(i,t[e],t[e+1]);return i}function Ki(i,t,e){i[0]=Math.min(i[0],t),i[1]=Math.min(i[1],e),i[2]=Math.max(i[2],t),i[3]=Math.max(i[3],e)}function Ve(i,t){let e;return e=t(Gt(i)),e||(e=t(Ut(i)),e)||(e=t(Dt(i)),e)||(e=t(j(i)),e)?e:!1}function Pt(i){let t=0;return ki(i)||(t=F(i)*Y(i)),t}function Gt(i){return[i[0],i[1]]}function Ut(i){return[i[2],i[1]]}function Je(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Qe(i,t){let e;if(t==="bottom-left")e=Gt(i);else if(t==="bottom-right")e=Ut(i);else if(t==="top-left")e=j(i);else if(t==="top-right")e=Dt(i);else throw new Error("Invalid corner");return e}function Y(i){return i[3]-i[1]}function bt(i,t,e){let r=e||D();return wt(i,t)?(i[0]>t[0]?r[0]=i[0]:r[0]=t[0],i[1]>t[1]?r[1]=i[1]:r[1]=t[1],i[2]<t[2]?r[2]=i[2]:r[2]=t[2],i[3]<t[3]?r[3]=i[3]:r[3]=t[3]):Zi(r),r}function j(i){return[i[0],i[3]]}function Dt(i){return[i[2],i[3]]}function F(i){return i[2]-i[0]}function wt(i,t){return i[0]<=t[2]&&i[2]>=t[0]&&i[1]<=t[3]&&i[3]>=t[1]}function ki(i){return i[2]<i[0]||i[3]<i[1]}function $e(i,t,e){let r=!1,n=ke(i,t),s=ke(i,e);if(n===w.INTERSECTING||s===w.INTERSECTING)r=!0;else{let o=i[0],l=i[1],a=i[2],c=i[3],u=t[0],m=t[1],y=e[0],P=e[1],h=(P-m)/(y-u),f,_;s&w.ABOVE&&!(n&w.ABOVE)&&(f=y-(P-c)/h,r=f>=o&&f<=a),!r&&s&w.RIGHT&&!(n&w.RIGHT)&&(_=P-(y-a)*h,r=_>=l&&_<=c),!r&&s&w.BELOW&&!(n&w.BELOW)&&(f=y-(P-l)/h,r=f>=o&&f<=a),!r&&s&w.LEFT&&!(n&w.LEFT)&&(_=P-(y-o)*h,r=_>=l&&_<=c)}return r}var qi=63710088e-1;function ae(i,t,e){e=e||qi;let r=Lt(i[1]),n=Lt(t[1]),s=(n-r)/2,o=Lt(t[0]-i[0])/2,l=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(r)*Math.cos(n);return 2*e*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}function ce(i,t){if(t!==void 0){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];t=t}else t=i.slice();return t}function ei(i,t){if(t!==void 0&&i!==t){for(let e=0,r=i.length;e<r;++e)t[e]=i[e];i=t}return i}function Bi(i){Ze(i.getCode(),i),Tt(i,i,ce)}function Hi(i){i.forEach(Bi)}function I(i){return typeof i=="string"?Ne(i):i||null}function ue(i,t,e,r){i=I(i);let n,s=i.getPointResolutionFunc();if(s){if(n=s(t,e),r&&r!==i.getUnits()){let o=i.getMetersPerUnit();o&&(n=n*o/q[r])}}else{let o=i.getUnits();if(o=="degrees"&&!r||r=="degrees")n=t;else{let l=he(i,I("EPSG:4326"));if(l===ei&&o!=="degrees")n=t*i.getMetersPerUnit();else{let c=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];c=l(c,c,2);let u=ae(c.slice(0,2),c.slice(2,4)),m=ae(c.slice(4,6),c.slice(6,8));n=(u+m)/2}let a=r?q[r]:i.getMetersPerUnit();a!==void 0&&(n/=a)}}return n}function ti(i){Hi(i),i.forEach(function(t){i.forEach(function(e){t!==e&&Tt(t,e,ce)})})}function Vi(i,t,e,r){i.forEach(function(n){t.forEach(function(s){Tt(n,s,e),Tt(s,n,r)})})}function W(i,t){if(i===t)return!0;let e=i.getUnits()===t.getUnits();return(i.getCode()===t.getCode()||he(i,t)===ce)&&e}function he(i,t){let e=i.getCode(),r=t.getCode(),n=Ke(e,r);return n||(n=ei),n}function fe(i,t){let e=I(i),r=I(t);return he(e,r)}function ii(i,t,e){return fe(t,e)(i,void 0,i.length)}function Ji(){ti(ne),ti(se),Vi(se,ne,je,We)}Ji();function ri(i){return Math.pow(i,3)}function Rt(i,t,e,r,n,s){let o=0,l=i[e-r],a=i[e-r+1];for(;t<e;t+=r){let c=i[t],u=i[t+1];a<=s?u>s&&(c-l)*(s-a)-(n-l)*(u-a)>0&&o++:u<=s&&(c-l)*(s-a)-(n-l)*(u-a)<0&&o--,l=c,a=u}return o!==0}function ni(i,t,e,r,n){let s;for(t+=r;t<e;t+=r)if(s=n(i.slice(t-r,t),i.slice(t,t+r)),s)return s;return!1}function Qi(i,t,e,r,n){let s=He(D(),i,t,e,r);return wt(n,s)?qe(n,s)||s[0]>=n[0]&&s[2]<=n[2]||s[1]>=n[1]&&s[3]<=n[3]?!0:ni(i,t,e,r,function(o,l){return $e(n,o,l)}):!1}function si(i,t,e,r,n){return!!(Qi(i,t,e,r,n)||Rt(i,t,e,r,n[0],n[1])||Rt(i,t,e,r,n[0],n[3])||Rt(i,t,e,r,n[2],n[1])||Rt(i,t,e,r,n[2],n[3]))}function oi(i,t,e){return e===void 0&&(e=[0,0]),e[0]=i[0]*t+.5|0,e[1]=i[1]*t+.5|0,e}function L(i,t){return Array.isArray(i)?i:(t===void 0?t=[i,i]:(t[0]=i,t[1]=i),t)}var z=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",_n=z.includes("firefox"),$i=z.includes("safari")&&!z.includes("chrom"),En=$i&&(z.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(z)),xn=z.includes("webkit")&&!z.includes("edge"),Tn=z.includes("macintosh");var li=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,ai=typeof Image<"u"&&Image.prototype.decode;var Cn=function(){let i=!1;try{let t=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return i}();function ot(i,t,e,r){let n;return e&&e.length?n=e.shift():li?n=new OffscreenCanvas(i||300,t||300):n=document.createElement("canvas"),i&&(n.width=i),t&&(n.height=t),n.getContext("2d",r)}function Ft(i){let t=i.canvas;t.width=1,t.height=1,i.clearRect(0,0,1,1)}function ci(i,t,e){let r=i,n=!0,s=!1,o=!1,l=[et(r,M.LOAD,function(){o=!0,s||t()})];return r.src&&ai?(s=!0,r.decode().then(function(){n&&t()}).catch(function(a){n&&(o?t():e())})):l.push(et(r,M.ERROR,e)),function(){n=!1,l.forEach(G)}}var d={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};var de=class extends vt{constructor(t,e,r){super(),r=r||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=r.transition===void 0?250:r.transition,this.transitionStarts_={},this.interpolate=!!r.interpolate}changed(){this.dispatchEvent(M.CHANGE)}release(){this.state===d.ERROR&&this.setState(d.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let t=this.interimTile;if(!t)return this;do{if(t.getState()==d.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){let t=this.interimTile;if(!t)return;let e=this;do{if(t.getState()==d.LOADED){t.interimTile=null;break}t.getState()==d.LOADING?e=t:t.getState()==d.IDLE?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==d.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){Mt()}getAlpha(t,e){if(!this.transition_)return 1;let r=this.transitionStarts_[t];if(!r)r=e,this.transitionStarts_[t]=r;else if(r===-1)return 1;let n=e-r+1e3/60;return n>=this.transition_?1:ri(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}},Yt=de;var ge=class extends Yt{constructor(t,e,r,n,s,o){super(t,e,o),this.crossOrigin_=n,this.src_=r,this.key=r,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=d.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=d.ERROR,this.unlistenImage_(),this.image_=tr(),this.changed()}handleImageLoad_(){let t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=d.LOADED:this.state=d.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==d.ERROR&&(this.state=d.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==d.IDLE&&(this.state=d.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=ci(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};function tr(){let i=ot(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}var ui=ge;var er=10,hi=.25,me=class{constructor(t,e,r,n,s,o){this.sourceProj_=t,this.targetProj_=e;let l={},a=fe(this.targetProj_,this.sourceProj_);this.transformInv_=function(g){let p=g[0]+"/"+g[1];return l[p]||(l[p]=a(g)),l[p]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&F(n)>=F(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?F(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?F(this.targetProj_.getExtent()):null;let c=j(r),u=Dt(r),m=Ut(r),y=Gt(r),P=this.transformInv_(c),h=this.transformInv_(u),f=this.transformInv_(m),_=this.transformInv_(y),T=er+(o?Math.max(0,Math.ceil(Math.log2(Pt(r)/(o*o*256*256)))):0);if(this.addQuad_(c,u,m,y,P,h,f,_,T),this.wrapsXInSource_){let g=1/0;this.triangles_.forEach(function(p,x,E){g=Math.min(g,p.source[0][0],p.source[1][0],p.source[2][0])}),this.triangles_.forEach(p=>{if(Math.max(p.source[0][0],p.source[1][0],p.source[2][0])-g>this.sourceWorldWidth_/2){let x=[[p.source[0][0],p.source[0][1]],[p.source[1][0],p.source[1][1]],[p.source[2][0],p.source[2][1]]];x[0][0]-g>this.sourceWorldWidth_/2&&(x[0][0]-=this.sourceWorldWidth_),x[1][0]-g>this.sourceWorldWidth_/2&&(x[1][0]-=this.sourceWorldWidth_),x[2][0]-g>this.sourceWorldWidth_/2&&(x[2][0]-=this.sourceWorldWidth_);let E=Math.min(x[0][0],x[1][0],x[2][0]);Math.max(x[0][0],x[1][0],x[2][0])-E<this.sourceWorldWidth_/2&&(p.source=x)}})}l={}}addTriangle_(t,e,r,n,s,o){this.triangles_.push({source:[n,s,o],target:[t,e,r]})}addQuad_(t,e,r,n,s,o,l,a,c){let u=le([s,o,l,a]),m=this.sourceWorldWidth_?F(u)/this.sourceWorldWidth_:null,y=this.sourceWorldWidth_,P=this.sourceProj_.canWrapX()&&m>.5&&m<1,h=!1;if(c>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){let _=le([t,e,r,n]);h=F(_)/this.targetWorldWidth_>hi||h}!P&&this.sourceProj_.isGlobal()&&m&&(h=m>hi||h)}if(!h&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!wt(u,this.maxSourceExtent_))return;let f=0;if(!h&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(a[0])||!isFinite(a[1]))){if(c>0)h=!0;else if(f=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(a[0])||!isFinite(a[1])?1:0),f!=1&&f!=2&&f!=4&&f!=8)return}if(c>0){if(!h){let _=[(t[0]+r[0])/2,(t[1]+r[1])/2],T=this.transformInv_(_),g;P?g=(rt(s[0],y)+rt(l[0],y))/2-rt(T[0],y):g=(s[0]+l[0])/2-T[0];let p=(s[1]+l[1])/2-T[1];h=g*g+p*p>this.errorThresholdSquared_}if(h){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){let _=[(e[0]+r[0])/2,(e[1]+r[1])/2],T=this.transformInv_(_),g=[(n[0]+t[0])/2,(n[1]+t[1])/2],p=this.transformInv_(g);this.addQuad_(t,e,_,g,s,o,T,p,c-1),this.addQuad_(g,_,r,n,p,T,l,a,c-1)}else{let _=[(t[0]+e[0])/2,(t[1]+e[1])/2],T=this.transformInv_(_),g=[(r[0]+n[0])/2,(r[1]+n[1])/2],p=this.transformInv_(g);this.addQuad_(t,_,g,n,s,T,p,a,c-1),this.addQuad_(_,e,r,g,T,o,l,p,c-1)}return}}if(P){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}f&11||this.addTriangle_(t,r,n,s,l,a),f&14||this.addTriangle_(t,r,e,s,l,o),f&&(f&13||this.addTriangle_(e,n,t,o,a,s),f&7||this.addTriangle_(e,n,r,o,a,l))}calculateSourceExtent(){let t=D();return this.triangles_.forEach(function(e,r,n){let s=e.source;yt(t,s[0]),yt(t,s[1]),yt(t,s[2])}),t}getTriangles(){return this.triangles_}},fi=me;var pe,B=[];function di(i,t,e,r,n){i.beginPath(),i.moveTo(0,0),i.lineTo(t,e),i.lineTo(r,n),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(t,r)+1,Math.max(e,n)),i.restore()}function _e(i,t){return Math.abs(i[t*4]-210)>2||Math.abs(i[t*4+3]-.75*255)>2}function ir(){if(pe===void 0){let i=ot(6,6,B);i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",di(i,4,5,4,0),di(i,4,5,0,5);let t=i.getImageData(0,0,3,3).data;pe=_e(t,0)||_e(t,4)||_e(t,8),Ft(i),B.push(i.canvas)}return pe}function gi(i,t,e,r){let n=ii(e,t,i),s=ue(t,r,e),o=t.getMetersPerUnit();o!==void 0&&(s*=o);let l=i.getMetersPerUnit();l!==void 0&&(s/=l);let a=i.getExtent();if(!a||Xt(a,n)){let c=ue(i,s,n)/s;isFinite(c)&&c>0&&(s/=c)}return s}function mi(i,t,e,r){let n=Je(e),s=gi(i,t,n,r);return(!isFinite(s)||s<=0)&&Ve(e,function(o){return s=gi(i,t,o,r),isFinite(s)&&s>0}),s}function pi(i,t,e,r,n,s,o,l,a,c,u,m,y,P){let h=ot(Math.round(e*i),Math.round(e*t),B);if(m||(h.imageSmoothingEnabled=!1),a.length===0)return h.canvas;h.scale(e,e);function f(E){return Math.round(E*e)/e}h.globalCompositeOperation="lighter";let _=D();a.forEach(function(E,v,A){Be(_,E.extent)});let T,g=e/r,p=(m?1:1+Math.pow(2,-24))/g;if(!y||a.length!==1||c!==0){if(T=ot(Math.round(F(_)*g),Math.round(Y(_)*g),B),m||(T.imageSmoothingEnabled=!1),n&&P){let E=(n[0]-_[0])*g,v=-(n[3]-_[3])*g,A=F(n)*g,C=Y(n)*g;T.rect(E,v,A,C),T.clip()}a.forEach(function(E,v,A){let C=(E.extent[0]-_[0])*g,R=-(E.extent[3]-_[3])*g,Z=F(E.extent)*g,K=Y(E.extent)*g;E.image.width>0&&E.image.height>0&&T.drawImage(E.image,c,c,E.image.width-2*c,E.image.height-2*c,m?C:Math.round(C),m?R:Math.round(R),m?Z:Math.round(C+Z)-Math.round(C),m?K:Math.round(R+K)-Math.round(R))})}let x=j(o);return l.getTriangles().forEach(function(E,v,A){let C=E.source,R=E.target,Z=C[0][0],K=C[0][1],at=C[1][0],ct=C[1][1],ut=C[2][0],qt=C[2][1],ht=f((R[0][0]-x[0])/s),ft=f(-(R[0][1]-x[1])/s),J=f((R[1][0]-x[0])/s),Q=f(-(R[1][1]-x[1])/s),Bt=f((R[2][0]-x[0])/s),Ht=f(-(R[2][1]-x[1])/s),Vt=Z,Jt=K;Z=0,K=0,at-=Vt,ct-=Jt,ut-=Vt,qt-=Jt;let Gi=[[at,ct,0,0,J-ht],[ut,qt,0,0,Bt-ht],[0,0,at,ct,Q-ft],[0,0,ut,qt,Ht-ft]],dt=De(Gi);if(!dt)return;if(h.save(),h.beginPath(),ir()||!m){h.moveTo(J,Q);let O=4,mt=ht-J,Ie=ft-Q;for(let k=0;k<O;k++)h.lineTo(J+f((k+1)*mt/O),Q+f(k*Ie/(O-1))),k!=O-1&&h.lineTo(J+f((k+1)*mt/O),Q+f((k+1)*Ie/(O-1)));h.lineTo(Bt,Ht)}else h.moveTo(J,Q),h.lineTo(ht,ft),h.lineTo(Bt,Ht);h.clip(),h.transform(dt[0],dt[2],dt[1],dt[3],ht,ft),h.translate(_[0]-Vt,_[3]-Jt);let gt;if(T)gt=T.canvas,h.scale(p,-p);else{let O=a[0],mt=O.extent;gt=O.image,h.scale(F(mt)/gt.width,-Y(mt)/gt.height)}h.drawImage(gt,0,0),h.restore()}),T&&(Ft(T),B.push(T.canvas)),u&&(h.save(),h.globalCompositeOperation="source-over",h.strokeStyle="black",h.lineWidth=1,l.getTriangles().forEach(function(E,v,A){let C=E.target,R=(C[0][0]-x[0])/s,Z=-(C[0][1]-x[1])/s,K=(C[1][0]-x[0])/s,at=-(C[1][1]-x[1])/s,ct=(C[2][0]-x[0])/s,ut=-(C[2][1]-x[1])/s;h.beginPath(),h.moveTo(K,at),h.lineTo(R,Z),h.lineTo(ct,ut),h.closePath(),h.stroke()}),h.restore()),h.canvas}var Ee=class extends Yt{constructor(t,e,r,n,s,o,l,a,c,u,m,y){super(s,d.IDLE,y),this.renderEdges_=m!==void 0?m:!1,this.pixelRatio_=l,this.gutter_=a,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;let P=n.getTileCoordExtent(this.wrappedTileCoord_),h=this.targetTileGrid_.getExtent(),f=this.sourceTileGrid_.getExtent(),_=h?bt(P,h):P;if(Pt(_)===0){this.state=d.EMPTY;return}let T=t.getExtent();T&&(f?f=bt(f,T):f=T);let g=n.getResolution(this.wrappedTileCoord_[0]),p=mi(t,r,_,g);if(!isFinite(p)||p<=0){this.state=d.EMPTY;return}let x=u!==void 0?u:.5;if(this.triangulation_=new fi(t,r,_,f,p*x,g),this.triangulation_.getTriangles().length===0){this.state=d.EMPTY;return}this.sourceZ_=e.getZForResolution(p);let E=this.triangulation_.calculateSourceExtent();if(f&&(t.canWrapX()?(E[1]=pt(E[1],f[1],f[3]),E[3]=pt(E[3],f[1],f[3])):E=bt(E,f)),!Pt(E))this.state=d.EMPTY;else{let v=e.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let A=v.minX;A<=v.maxX;A++)for(let C=v.minY;C<=v.maxY;C++){let R=c(this.sourceZ_,A,C,l);R&&this.sourceTiles_.push(R)}this.sourceTiles_.length===0&&(this.state=d.EMPTY)}}getImage(){return this.canvas_}reproject_(){let t=[];if(this.sourceTiles_.forEach(e=>{e&&e.getState()==d.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}),this.sourceTiles_.length=0,t.length===0)this.state=d.ERROR;else{let e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n=typeof r=="number"?r:r[0],s=typeof r=="number"?r:r[1],o=this.targetTileGrid_.getResolution(e),l=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=pi(n,s,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=d.LOADED}this.changed()}load(){if(this.state==d.IDLE){this.state=d.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(e=>{let r=e.getState();if(r==d.IDLE||r==d.LOADING){t++;let n=tt(e,M.CHANGE,function(s){let o=e.getState();(o==d.LOADED||o==d.ERROR||o==d.EMPTY)&&(G(n),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(n)}}),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,r,n){e.getState()==d.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(G),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ft(this.canvas_.getContext("2d")),B.push(this.canvas_),this.canvas_=null),super.release()}},_i=Ee;var jt=class{constructor(t,e,r,n){this.minX=t,this.maxX=e,this.minY=r,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}};function H(i,t,e,r,n){return n!==void 0?(n.minX=i,n.maxX=t,n.minY=e,n.maxY=r,n):new jt(i,t,e,r)}var Ei=jt;var xe=class{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){let r=this.entries_[t];return S(r!==void 0,"Tried to get a value for a key that does not exist in the cache"),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}remove(t){let e=this.entries_[t];return S(e!==void 0,"Tried to get a value for a key that does not exist in the cache"),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){let t=new Array(this.count_),e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.key_;return t}getValues(){let t=new Array(this.count_),e=0,r;for(r=this.newest_;r;r=r.older)t[e++]=r.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){return this.entries_[t]?.value_}pop(){let t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){S(!(t in this.entries_),"Tried to set a value for a key that is used already");let r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_}setSize(t){this.highWaterMark=t}},xi=xe;function Te(i,t,e,r){return r!==void 0?(r[0]=i,r[1]=t,r[2]=e,r):[i,t,e]}function V(i,t,e){return i+"/"+t+"/"+e}function Wt(i){return V(i[0],i[1],i[2])}function Ti(i){return i.split("/").map(Number)}function Ci(i){return(i[1]<<i[0])+i[2]}function yi(i,t){let e=i[0],r=i[1],n=i[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;let s=t.getFullTileRange(e);return s?s.containsXY(r,n):!0}var Ce=class extends xi{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;let t=this.peekFirstKey(),r=Ti(t)[0];this.forEach(n=>{n.tileCoord[0]!==r&&(this.remove(Wt(n.tileCoord)),n.release())})}},zt=Ce;var Nt={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};var ye=class extends be{constructor(t){super(),this.projection=I(t.projection),this.attributions_=Pi(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;let e=this;this.viewPromise_=new Promise(function(r,n){e.viewResolver=r,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(t){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=Pi(t),this.changed()}setState(t){this.state_=t,this.changed()}};function Pi(i){return i?Array.isArray(i)?function(t){return i}:typeof i=="function"?i:function(t){return[i]}:null}var wi=ye;var lt=[0,0,0],N=5,Pe=class{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,S(Xe(this.resolutions_,(n,s)=>s-n,!0),"`resolutions` must be sorted in descending order");let e;if(!t.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,S(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let r=t.extent;r!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=j(r)),S(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,S(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:256,S(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=r!==void 0?r:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map((n,s)=>{let o=new Ei(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(r){let l=this.getTileRangeForExtentAndZ(r,s);o.minX=Math.max(l.minX,o.minX),o.maxX=Math.min(l.maxX,o.maxX),o.minY=Math.max(l.minY,o.minY),o.maxY=Math.min(l.maxY,o.maxY)}return o}):r&&this.calculateTileRanges_(r)}forEachTileCoord(t,e,r){let n=this.getTileRangeForExtentAndZ(t,e);for(let s=n.minX,o=n.maxX;s<=o;++s)for(let l=n.minY,a=n.maxY;l<=a;++l)r([e,s,l])}forEachTileCoordParentTileRange(t,e,r,n){let s,o,l,a=null,c=t[0]-1;for(this.zoomFactor_===2?(o=t[1],l=t[2]):a=this.getTileCoordExtent(t,n);c>=this.minZoom;){if(o!==void 0&&l!==void 0?(o=Math.floor(o/2),l=Math.floor(l/2),s=H(o,o,l,l,r)):s=this.getTileRangeForExtentAndZ(a,c,r),e(c,s))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,r){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){let s=t[1]*2,o=t[2]*2;return H(s,s+1,o,o+1,e)}let n=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;let n=t[0],s=t[1],o=t[2];if(e===n)return H(s,o,s,o,r);if(this.zoomFactor_){let a=Math.pow(this.zoomFactor_,e-n),c=Math.floor(s*a),u=Math.floor(o*a);if(e<n)return H(c,c,u,u,r);let m=Math.floor(a*(s+1))-1,y=Math.floor(a*(o+1))-1;return H(c,m,u,y,r)}let l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,e,r)}getTileRangeForExtentAndZ(t,e,r){this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,lt);let n=lt[1],s=lt[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,lt);let o=lt[1],l=lt[2];return H(n,o,s,l,r)}getTileCoordCenter(t){let e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=L(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]-(t[2]+.5)*n[1]*r]}getTileCoordExtent(t,e){let r=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=L(this.getTileSize(t[0]),this.tmpSize_),o=r[0]+t[1]*s[0]*n,l=r[1]-(t[2]+1)*s[1]*n,a=o+s[0]*n,c=l+s[1]*n;return Ct(o,l,a,c,e)}getTileCoordForCoordAndResolution(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)}getTileCoordForXYAndResolution_(t,e,r,n,s){let o=this.getZForResolution(r),l=r/this.getResolution(o),a=this.getOrigin(o),c=L(this.getTileSize(o),this.tmpSize_),u=l*(t-a[0])/r/c[0],m=l*(a[1]-e)/r/c[1];return n?(u=Et(u,N)-1,m=Et(m,N)-1):(u=_t(u,N),m=_t(m,N)),Te(o,u,m,s)}getTileCoordForXYAndZ_(t,e,r,n,s){let o=this.getOrigin(r),l=this.getResolution(r),a=L(this.getTileSize(r),this.tmpSize_),c=(t-o[0])/l/a[0],u=(o[1]-e)/l/a[1];return n?(c=Et(c,N)-1,u=Et(u,N)-1):(c=_t(c,N),u=_t(u,N)),Te(r,c,u,s)}getTileCoordForCoordAndZ(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){let r=Oe(this.resolutions_,t,e||0);return pt(r,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return si(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){let e=this.resolutions_.length,r=new Array(e);for(let n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r}},we=Pe;function Zt(i){let t=i.getDefaultTileGrid();return t||(t=sr(i),i.setDefaultTileGrid(t)),t}function Ri(i,t,e){let r=t[0],n=i.getTileCoordCenter(t),s=Kt(e);if(!Xt(s,n)){let o=F(s),l=Math.ceil((s[0]-n[0])/o);return n[0]+=o*l,i.getTileCoordForCoordAndZ(n,r)}return t}function nr(i,t,e,r){r=r!==void 0?r:"top-left";let n=Si(i,t,e);return new we({extent:i,origin:Qe(i,r),resolutions:n,tileSize:e})}function Fi(i){let t=i||{},e=t.extent||I("EPSG:3857").getExtent(),r={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Si(e,t.maxZoom,t.tileSize,t.maxResolution)};return new we(r)}function Si(i,t,e,r){t=t!==void 0?t:42,e=L(e!==void 0?e:256);let n=Y(i),s=F(i);r=r>0?r:Math.max(s/e[0],n/e[1]);let o=t+1,l=new Array(o);for(let a=0;a<o;++a)l[a]=r/Math.pow(2,a);return l}function sr(i,t,e,r){let n=Kt(i);return nr(n,t,e,r)}function Kt(i){i=I(i);let t=i.getExtent();if(!t){let e=180*q.degrees/i.getMetersPerUnit();t=Ct(-e,-e,e,e)}return t}var Re=class extends wi{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;let e=[256,256];this.tileGrid&&L(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new zt(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){let r=this.getTileCacheForProjection(t);r&&r.expireCache(e)}forEachLoadedTile(t,e,r,n){let s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,l,a,c;for(let u=r.minX;u<=r.maxX;++u)for(let m=r.minY;m<=r.maxY;++m)a=V(e,u,m),c=!1,s.containsKey(a)&&(l=s.get(a),c=l.getState()===d.LOADED,c&&(c=n(l)!==!1)),c||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(t){let e=t?this.getTileGridForProjection(t):this.tileGrid;return e?e.getResolutions():null}getTile(t,e,r,n,s){return Mt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Zt(t)}getTileCacheForProjection(t){let e=this.getProjection();return S(e===null||W(e,t),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,r){let n=this.getTileGridForProjection(r),s=this.getTilePixelRatio(e),o=L(n.getTileSize(t),this.tmpSize);return s==1?o:oi(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();let r=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Ri(r,t,e)),yi(t,r)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){let r=this.getTileCacheForProjection(e);t>r.highWaterMark&&(r.highWaterMark=t)}useTile(t,e,r,n){}},kt=class extends ${constructor(t,e){super(t),this.tile=e}},vi=Re;function or(i,t){let e=/\{z\}/g,r=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(o,l,a){if(o)return i.replace(e,o[0].toString()).replace(r,o[1].toString()).replace(n,o[2].toString()).replace(s,function(){let c=o[0],u=t.getFullTileRange(c);if(!u)throw new Error("The {-y} placeholder requires a tile grid with extent");return(u.getHeight()-o[2]-1).toString()})}}function Mi(i,t){let e=i.length,r=new Array(e);for(let n=0;n<e;++n)r[n]=or(i[n],t);return lr(r)}function lr(i){return i.length===1?i[0]:function(t,e,r){if(!t)return;let n=Ci(t),s=rt(n,i.length);return i[s](t,e,r)}}function Ii(i){let t=[],e=/\{([a-z])-([a-z])\}/.exec(i);if(e){let r=e[1].charCodeAt(0),n=e[2].charCodeAt(0),s;for(s=r;s<=n;++s)t.push(i.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(i),e){let r=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=r;n++)t.push(i.replace(e[0],n.toString()));return t}return t.push(i),t}var Fe=class i extends vi{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===i.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){let e=t.target,r=U(e),n=e.getState(),s;n==d.LOADING?(this.tileLoadingKeys_[r]=!0,s=Nt.TILELOADSTART):r in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[r],s=n==d.ERROR?Nt.TILELOADERROR:n==d.LOADED?Nt.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new kt(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){let e=Ii(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;let e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Mi(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,r){}useTile(t,e,r){let n=V(t,e,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)}},Li=Fe;var Se=class extends Li{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:ar,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:ui,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(let t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){let r=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==r?e:{});for(let n in this.tileCacheForProjection){let s=this.tileCacheForProjection[n];s.expireCache(s==r?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!W(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!W(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){let e=this.getProjection();if(this.tileGrid&&(!e||W(e,t)))return this.tileGrid;let r=U(t);return r in this.tileGridForProjection||(this.tileGridForProjection[r]=Zt(t)),this.tileGridForProjection[r]}getTileCacheForProjection(t){let e=this.getProjection();if(!e||W(e,t))return this.tileCache;let r=U(t);return r in this.tileCacheForProjection||(this.tileCacheForProjection[r]=new zt(this.tileCache.highWaterMark)),this.tileCacheForProjection[r]}createTile_(t,e,r,n,s,o){let l=[t,e,r],a=this.getTileCoordForTileUrlFunction(l,s),c=a?this.tileUrlFunction(a,n,s):void 0,u=new this.tileClass(l,c!==void 0?d.IDLE:d.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(M.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,r,n,s){let o=this.getProjection();if(!o||!s||W(o,s))return this.getTileInternal(t,e,r,n,o||s);let l=this.getTileCacheForProjection(s),a=[t,e,r],c,u=Wt(a);l.containsKey(u)&&(c=l.get(u));let m=this.getKey();if(c&&c.key==m)return c;let y=this.getTileGridForProjection(o),P=this.getTileGridForProjection(s),h=this.getTileCoordForTileUrlFunction(a,s),f=new _i(o,y,s,P,a,h,this.getTilePixelRatio(n),this.getGutter(),(_,T,g,p)=>this.getTileInternal(_,T,g,p,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return f.key=m,c?(f.interimTile=c,f.refreshInterimChain(),l.replace(u,f)):l.set(u,f),f}getTileInternal(t,e,r,n,s){let o=null,l=V(t,e,r),a=this.getKey();if(!this.tileCache.containsKey(l))o=this.createTile_(t,e,r,n,s,a),this.tileCache.set(l,o);else if(o=this.tileCache.get(l),o.key!=a){let c=o;o=this.createTile_(t,e,r,n,s,a),c.getState()==d.IDLE?o.interimTile=c.interimTile:o.interimTile=c,o.refreshInterimChain(),this.tileCache.replace(l,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(let e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){let r=I(t);if(r){let n=U(r);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}clear(){super.clear();for(let t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}};function ar(i,t){i.getImage().src=t}var Ai=Se;var ve=class extends Ai{constructor(t){t=t||{};let e=t.projection!==void 0?t.projection:"EPSG:3857",r=t.tileGrid!==void 0?t.tileGrid:Fi({extent:Kt(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}},Oi=ve;var Me=class extends Oi{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:t.maxZoom!==void 0?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,transition:t.transition,wrapX:t.wrapX,zDirection:t.zDirection}),this.account_=t.account,this.mapId_=t.map||"",this.config_=t.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(t){Object.assign(this.config_,t),this.initializeMap_()}setConfig(t){this.config_=t||{},this.initializeMap_()}initializeMap_(){let t=JSON.stringify(this.config_);if(this.templateCache_[t]){this.applyTemplate_(this.templateCache_[t]);return}let e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);let r=new XMLHttpRequest;r.addEventListener("load",this.handleInitResponse_.bind(this,t)),r.addEventListener("error",this.handleInitError_.bind(this)),r.open("POST",e),r.setRequestHeader("Content-type","application/json"),r.send(JSON.stringify(this.config_))}handleInitResponse_(t,e){let r=e.target;if(!r.status||r.status>=200&&r.status<300){let n;try{n=JSON.parse(r.responseText)}catch{this.setState("error");return}this.applyTemplate_(n),this.templateCache_[t]=n,this.setState("ready")}else this.setState("error")}handleInitError_(t){this.setState("error")}applyTemplate_(t){let e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)}},Xi=Me;function cr({model:i,el:t}){let e=()=>i.get("cartodblayer");console.log("test1");let r={layers:[{type:"cartodb",options:{cartocss_version:"2.1.1",cartocss:"#layer { polygon-fill: #F00; }"}}]},n=new Xi({account:"documentation",config:r});i.set("cartodblayer",n),console.log("test2"),console.log(`le nv layer: ${e()}`),i.save_changes()}var xo={render:cr};export{xo as default};
